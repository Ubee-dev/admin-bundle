{# templates/media/filename.html.twig - Version avec troncature intelligente #}
<div class="media-filename">
    {% set media = entity.instance %}

    {# Fonction pour tronquer le nom de fichier au milieu #}
    {% set filename = media.filename %}
    {% set maxLength = 40 %}
    {% if filename|length > maxLength %}
        {% set extension = filename|split('.')|last %}
        {% set nameWithoutExt = filename|slice(0, -(extension|length + 1)) %}
        {% set keepStart = 15 %}
        {% set keepEnd = 10 %}
        {% if nameWithoutExt|length > (keepStart + keepEnd) %}
            {% set truncatedName = nameWithoutExt|slice(0, keepStart) ~ '...' ~ nameWithoutExt|slice(-(keepEnd)) ~ '.' ~ extension %}
        {% else %}
            {% set truncatedName = filename %}
        {% endif %}
    {% else %}
        {% set truncatedName = filename %}
    {% endif %}

    {% if media.isImage and not media.private %}
        <div class="d-flex align-items-center">
            {# Pour les images publiques, on peut essayer d'afficher une miniature #}
            <div class="me-2">
                <i class="fa fa-image text-primary" style="font-size: 24px;"></i>
            </div>
            <div class="flex-grow-1 min-width-0">
                <strong class="text-truncate d-block" title="{{ media.filename }}">{{ truncatedName }}</strong>
                {% if media.alt %}
                    <small class="text-muted text-truncate d-block">{{ media.alt }}</small>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="d-flex align-items-center">
            {% if media.contentType starts with 'image/' %}
                <i class="fa fa-image text-primary me-2"></i>
            {% elseif media.contentType starts with 'video/' %}
                <i class="fa fa-video text-info me-2"></i>
            {% elseif media.contentType starts with 'audio/' %}
                <i class="fa fa-music text-success me-2"></i>
            {% elseif media.contentType == 'application/pdf' %}
                <i class="fa fa-file-pdf text-danger me-2"></i>
            {% else %}
                <i class="fa fa-file text-secondary me-2"></i>
            {% endif %}

            <div class="flex-grow-1 min-width-0">
                <strong class="text-truncate d-block" title="{{ media.filename }}">{{ truncatedName }}</strong>
                <div class="d-flex align-items-center gap-2">
                    {% if media.private %}
                        <span class="badge bg-warning">Private</span>
                    {% endif %}
                    {% if media.alt %}
                        <small class="text-muted text-truncate">{{ media.alt }}</small>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endif %}
</div>

<style>
    .media-filename {
        max-width: 100%;
    }

    .media-filename .min-width-0 {
        min-width: 0; /* Permet la troncature dans flexbox */
    }

    .media-filename .text-truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
</style>